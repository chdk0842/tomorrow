<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout1}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<th:block layout:fragment="script">
	<script th:inline="javascript">
		$(document).ready(function(){
        	var errorMessage = [[${errorMessage}]];
        	if(errorMessage != null){
            	alert(errorMessage);
        	}
        	
        	bindDomEvent();
    	});
		//파일 첨부시 이미지 파일인지 검사를 한다.
        function bindDomEvent(){
            $(".custom-file-input").on("change", function() {
                var fileName = $(this).val().split("\\").pop();  //이미지 파일명
                var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
                fileExt = fileExt.toLowerCase(); //소문자 변환

                if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
                    alert("이미지 파일만 등록이 가능합니다.");
                    return;
                }
                $(this).siblings(".custom-file-label").html(fileName);
            });
        }
	</script>
</th:block>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<th:block layout:fragment="css">
	<style>
		.input-group {
            margin-bottom : 15px
        }
        .img-div {
            margin-bottom : 10px
        }
        .fieldError {
            color: #bd2130;
        }
	</style>
</th:block>
</head>
<body> 
	<div layout:fragment="content">	
   	   <input type="hidden" id="boardId" th:value="${board.id}">
	   <div class="post-frm container-lg d-flex flex-column noti-wrap">
   			<p th:text="'작성자 : '+${board.member.userNm}"></p>
   			<hr>
	   		<form method="post" >
	   			<div class="post-title d-flex">
					<p th:text="'제목 : '+${board.boardTitle}+' | 조회수 : ' + ${board.viewCount}"></p>
					<a href="#">삭제</a>
	   			</div>
	   			<hr>
	   			<div class="post-text">
	   				<textarea class="w-100 h-40 board-textarea" th:text="${board.boardCont}"> 
	   					 
	   				</textarea>
	   			<div class="reg-date">
	   				<p th:text="'등록일 : '+${board.regTime}"></p>
	   			</div>
		   			<hr>
	   			</div>
	   			<div class="post-buttons">
      			<button class="post-btns m-1" type="button" th:onclick="'location.href=\'update/'+ @{${board.id}} + '\''">수정하기</button>	
	   				<button class="post-btns m-1" type="button" th:onclick="location.href=''+'/comment/board_id'">댓글 보기</button>
	   				<button class="post-btns m-1" type="button" onclick="location.href='/board/list'">목록</button>
	   			</div>
	   			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
	   		</form>
	   		
	   		<div th:each="boardImg : ${board.boardImgDtoList}" class="">
          		<img th:if="${not #strings.isEmpty(boardImg.boImgUrl)}" th:src="${boardImg.boImgUrl}" class="detail-img" width="800">
 			</div>
 			<!-------------------------- 댓글 영역 --------------------------->
			<div class="comment-input">
				<form method="post" th:object="${boardComment}">
				    <input type="hidden" id="boardId" th:field="*{board.id}" th:value="${board.id}">
  	   				<input type="hidden" th:field="*{member}" th:value="${member}"/>
				    
					<input type="text" placeholder="댓글 입력창" th:field="*{boCmtText}"/>
					<p th:if="${#fields.hasErrors('boCmtText')}" th:errors="*{boCmtText}" class="fieldError">Incorrect Data</p>
					<button type="submit" th:formaction="@{'/board/comment/' + ${board.id} }">댓글 등록</button>
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">			
				</form>
			</div> 
			<div class="comment-list">
				<p>댓글 리스트</p>
				<!--
				<ul>
					<li>
						<div th:each="comment : ${comments.getContent()}">
							<div class="comment-writer" th:text="${comment.member.userNm}"></div>
							<div class="comment-text" th:text="${comment.boCmtText}"></div>
							<div class="comment-reg"  th:text="${comment.regTime}"></div>
						</div>
					</li>
				</ul>
				-->
			</div>
	   </div>
	    
    </div>
</body>
</html>